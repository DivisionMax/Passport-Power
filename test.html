<html>
  <head>
    <link href='http://fonts.googleapis.com/css?family=Varela' rel='stylesheet' type='text/css'>
    <!-- Load the d3 library. -->
    <script src="d3.min.js" charset="utf-8"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <script src="http://d3js.org/topojson.v1.min.js"></script>
    <style>
        body { 
            font-family: 'Varela', sans-serif; 
            } 
        div { 
            margin: 30px; 
        }
        svg { }

        .axis path { fill: none; stroke: #777; }
        .axis line { stroke: #777; }
    </style>
  </head>

  <body>
    <div id="canvas"></div>
    <script>
        //bubble chart start
        var numbers;
        d3.json("cleandata.json", function (error, data){
            numbers = data;
            var maxGDP = d3.max(numbers, function(d) {return d.gdp_percapita});
            var maxIncoming = d3.max(numbers, function(d) {return d.incoming});
            var maxOutgoing = d3.max(numbers, function(d) {return d.outgoing});
            var arrayNumConnections = [];
            var maxNumConnections = d3.max(arrayNumConnections);
  
            function pushNumConnections() {
              for (var i = 0; i < numbers.length; i++){
                  arrayNumConnections.push(numbers[i].connections.length);
              }
              return arrayNumConnections;
            }
            pushNumConnections();
            
            function getNumConnections(code) {
              for (var i = 0; i < numbers.length; i++){
                  console.log("this method ");
                  if (numbers[i].iso3_digit_code == code) {
                    
                    return numbers[i].connections.length;
                  }
              }
              return 0;
            }
            
            var svg = d3.select("#canvas").append("svg")
            .attr("height", 1000)
            .attr("width", 1150);
        
            var g = svg.append("g");
            var xScale = d3.scale.linear().range([40, 750]).domain([0, maxGDP+10]);
            var yScale = d3.scale.linear().range([1000, 40]).domain([0, maxIncoming+10]);
            var radiusScale = d3.scale.sqrt().range([0, 30]).domain([0, maxNumConnections]);
            
            var contents = svg.append("g");
            
            var circles = svg.selectAll("circle").data(numbers)
            .enter().append("circle");
            
            //Figuring out the colors for each circle depending on the country
            circles
            .attr("cx", function (d) { return xScale( d.gdp_percapita) })
            .attr("cy", function (d) { return yScale(d.incoming) })
            .attr("r",  function (d) { return radiusScale(function (d) {return getNumConnections(d.iso3_digit_code) })})
            .attr("opacity", 0.7)
            .style("fill", "#333");
            
          var texts = contents.selectAll("text").data(numbers).enter().append("text");
    
          texts.attr("x", function(d) { return xScale(d.incoming) })
            .attr("y", function(d) { return yScale(d.outgoing) })
            .text(function(d) { return d.country_name; })
            .style({opacity:'0.8'});
        });
    </script>